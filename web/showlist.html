<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Show todo list</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="js/jweb.js"></script>
    <script>$(function(){$('#navbar').load('navbar.html');});</script>

    <script>
        function populateList(listID) {
            $.ajax({
                url: 'todolist/get-list',
                method: 'GET',
                success: function (response) {
                    var list = document.getElementById(listID);
                    list.innerHTML = '';
                    var items = response['items'];
                    if (items.length == 0) {
                        var li = document.createElement('li');
                        li.className = 'list-group-item list-group-item-action p-2';
                        li.innerHTML = '<div class="w-100"><h3>Your to-do list is empty!</h3><h4>Time to go outside and touch grass</h4></div>';
                        list.appendChild(li);
                    }
                    for (var i = 0; i < items.length; ++i) {
                        if (i > 0) {
                            var gap = document.createElement('li');
                            gap.className = 'list-group-item bg-dark-subtle p-1';
                            list.appendChild(gap);
                        }
                        var li = document.createElement('li');
                        li.className = 'list-group-item list-group-item-action p-2';
                        li.innerHTML = '<div class="d-flex w-100 justify-content-between border-bottom">\n' +
                            '<h5 class="mb-1 text-muted">' + items[i]['title'] + '</h5>\n' +
                            '<small class="text-muted">' + items[i]['deadline'] + '</small>\n' +
                            '</div>\n' +
                            '<div class="mt-2">' + items[i]['description'] + '</div>';   // Use innerHTML to set the text
                        list.appendChild(li);
                    }
                },
                error: function (xhr, status, error) {
                    alert(status + ':' + error);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            //makeToast('itemAddedContainer', 'itemAdded', "To-do list", "To-do list item added");
            $('#itemAdded').toast();
        });

        $(function(){
            $('#addItem').click(function(e){
                e.preventDefault();
                $.ajax({
                    url: "/todolist/add-item",
                    type: "POST",
                    data: $('#addItemForm').serialize(),
                    success: function(data){
                        showToast('itemAdded');
                        populateList('todoList');
                    }
                });
            });
        });
    </script>


</head>
<body>

<div id="navbar"></div>
<div id="navbar_padding" style="height: 63px"></div>

<div class="container p-3">
    <h2 class="text-muted">Your to-do list</h2>
    <div class="bg-dark-subtle p-3">
        <ul class="list-group list-group-flush" id="todoList">
            <script>populateList('todoList')</script>
        </ul>
        <button type="button" class="btn btn-primary rounded-pill mt-3 w-100 p-0 fw-bold" style="font-size: xx-large"
                    data-bs-toggle="modal" data-bs-target="#staticBackdrop">+</button>
        </div>
    </div>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addItemForm" method="post">
                        <div class="container mt-3 p-3 bg-body-secondary rounded">
                            <div>
                                <label class="form-label" for="title">Title</label>
                                <input type="text" class="form-control" id="title" name="title" placeholder="Title">
                            </div>
                            <div class="mt-2">
                                <label class="form-label" for="deadline">Deadline</label>
                                <input type="datetime-local" class="form-control" id="deadline" name="deadline" placeholder="Deadline">
                            </div>
                            <div class="mt-2">
                                <label class="form-label" for="description">Description</label>
                                <textarea class="form-control" rows="3" id="description" name="description" placeholder="Description"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" style="max-width:120px" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
                    <button id='addItem' type="submit" style="max-width:120px" class="btn btn-primary rounded-pill me-2" data-bs-dismiss="modal">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <div id="itemAddedContainer" class="toast-container position-absolute p-3 top-50 start-50 translate-middle">
        <div id="itemAdded" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
            <div class="toast-header">
                <strong class="me-auto">To-do list</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body text-muted">
                <h2>Item successfully added</h2>
            </div>
        </div>
    </div>

</body>
</html>